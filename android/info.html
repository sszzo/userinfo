<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>نموذج العملاء</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background: #f4f4f4;
      padding: 20px;
      direction: rtl;
    }
    .container {
      max-width: 500px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h2 {
      text-align: center;
      margin-bottom: 20px;
    }
    input, select, button {
      width: 100%;
      padding: 12px;
      margin-bottom: 15px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #45a049;
    }
    .file-input-wrapper {
      position: relative;
      overflow: hidden;
      width: 100%;
      margin-bottom: 12px;
    }
    .file-input-wrapper input[type="file"] {
      opacity: 0;
      position: absolute;
      z-index: -1;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>إضافة عميل</h2>
    <input type="text" id="name" placeholder="الاسم الكامل">
    <input type="text" id="number" placeholder="رقم الهاتف">
    <input type="text" id="note" placeholder="ملاحظات">
    <select id="durationOption" onchange="updateEndDate()">
      <option value="30">30 يوم</option>
      <option value="0">في نفس اليوم</option>
    </select>
    <input type="text" id="startDate" placeholder="تاريخ التفعيل" readonly>
    <input type="text" id="endDate" placeholder="تاريخ الانتهاء" readonly>
    
    <button onclick="addClient()">إضافة</button>
    
    <div class="file-input-wrapper">
      <input type="file" id="fileInput" accept=".json" onchange="loadJSONFile()">
      <button onclick="document.getElementById('fileInput').click()">اختيار ملف لرفع البيانات</button>
    </div>
    
    <button onclick="downloadJSON()">تحميل البيانات</button>
  </div>

  <script>
    let clients = [];

    document.getElementById("startDate").value = getTodayDate();
    updateEndDate();

    function getTodayDate() {
      const today = new Date();
      return today.toISOString().split('T')[0];
    }

    function updateEndDate() {
      const option = document.getElementById("durationOption").value;
      const startDate = new Date(document.getElementById("startDate").value);
      let endDate = new Date(startDate);

      if (option === "30") {
        endDate.setDate(endDate.getDate() + 30);
      }

      document.getElementById("endDate").value = endDate.toISOString().split('T')[0];
    }

    function addClient() {
      const name = document.getElementById("name").value.trim();
      const number = document.getElementById("number").value.trim();
      const note = document.getElementById("note").value.trim();
      const startDate = document.getElementById("startDate").value;
      const endDate = document.getElementById("endDate").value;

      if (!name || !number) {
        alert("يرجى إدخال الاسم ورقم الهاتف");
        return;
      }

      clients.push({ name, number, note, startDate, endDate });
      alert("تمت إضافة العميل!");
      document.getElementById("name").value = "";
      document.getElementById("number").value = "";
      document.getElementById("note").value = "";
    }

    function downloadJSON() {
      const jsonStr = JSON.stringify(clients, null, 2);
      if (typeof Android !== "undefined" && Android.saveFile) {
        Android.saveFile(jsonStr);
      } else {
        const blob = new Blob([jsonStr], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "clients.json";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      }
    }

    function loadJSONFile() {
      const fileInput = document.getElementById("fileInput");
      const file = fileInput.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          try {
            const importedData = JSON.parse(e.target.result);
            if (Array.isArray(importedData)) {
              clients = clients.concat(importedData);
              alert("تم تحميل البيانات من الملف بنجاح");
            } else {
              alert("الملف غير صالح. تأكد أنه ملف JSON يحتوي على قائمة من العناصر.");
            }
          } catch (err) {
            alert("حدث خطأ أثناء قراءة الملف.");
          }
        };
        reader.readAsText(file);
      }
    }
  </script>
</body>
</html>
